<section *ngIf="post" id="noticias-main-container" class="pr pt-71">
  <div id="noticias-content-container">
    <div class="noticias-data dfr">
      <!-- Detail Post Card -->
      <div class="card sticky-action" style="width: calc(100% - 430px)">
        <div class="card-header card-content">
          <div class="card-date">
            <div class="card-day">
              <span>{{ post?.created_at | date: "dd" }}</span>
            </div>
            <div class="card-month">
              <span>{{ post?.created_at | date: "MMM" }}</span>
            </div>
          </div>
          <div class="card-title-new">
            <span class="card-title">{{ post?.title }}</span>
            <span class="card-autor"
              >{{ post?.user?.firstName }} {{ post?.user?.lastName }}</span
            >
          </div>
        </div>
        <div
          class="card-body-container card-body card-content grey lighten-4 dfc"
        >
          <div class="card-data">
            <div class="card-img centered-img-bg card-image">
              <img [src]="post?.img | img: 'post'" />
            </div>
            <span class="card-data-container">
              <span
                class="card-information"
                [innerHTML]="post?.content | sanitizeHtml"
              ></span>
              <span
                *ngIf="post?.external_sources"
                class="card-external-sources"
              >
                Fuente: {{ post?.external_sources }}
              </span>
            </span>
          </div>
        </div>
        <div class="card-footer card-action">
          <div class="item-acordion-body-actions dfr">
            <!-- Post Contact Author By Email Button Trigger -->
            <button
              *ngIf="
                _usersS.isLogged()
                  ? postAuthor._id !== this._usersS.user._id
                  : true
              "
              class="header-item-btn btn action-button dfc"
              mat-icon-button
              matTooltip="Contactar autor por correo"
              matTooltipPosition="above"
              (click)="openReplyModal(post.user)"
            >
              <i class="far fa-envelope"></i>
            </button>
            <!-- Post Contact Author By Message Button Trigger -->
            <button
              *ngIf="
                _usersS.isLogged() && postAuthor._id !== this._usersS.user._id
              "
              class="header-item-btn btn action-button important-action dfc"
              mat-icon-button
              matTooltip="Contactar autor por mensaje"
              matTooltipPosition="above"
              (click)="openChat(post.user)"
            >
              <i class="far fa-comment"></i>
            </button>
            <div class="action-button-with-text-container dfc">
              <!-- Post Like Button Trigger -->
              <button
                class="header-item-btn btn posts-btn action-button dfc"
                mat-icon-button
                matTooltip="Me gusta"
                matTooltipPosition="above"
                (click)="
                  this._usersS.isLogged()
                    ? updatePostReactions('like')
                    : showAlertModal('like', $event)
                "
                [attr.data-active]="
                  postAnalyticsReaction === 'like' ? true : false
                "
              >
                <i class="waves-effect material-icons new-like">thumb_up</i>
              </button>
              <span
                class="action-counter"
                [attr.data-active]="
                  postAnalyticsReaction === 'like' ? true : false
                "
                >{{ postAnalytics?.likes }}</span
              >
            </div>
            <div class="action-button-with-text-container dfc">
              <!-- Post Dislike Button Trigger -->
              <button
                class="header-item-btn btn posts-btn action-button dfc"
                mat-icon-button
                matTooltip="No me gusta"
                matTooltipPosition="above"
                (click)="
                  this._usersS.isLogged()
                    ? updatePostReactions('dislike')
                    : showAlertModal('dislike', $event)
                "
                [attr.data-active]="
                  postAnalyticsReaction === 'dislike' ? true : false
                "
              >
                <i class="waves-effect material-icons new-dislike">
                  thumb_down
                </i>
              </button>
              <span
                class="action-counter"
                [attr.data-active]="
                  postAnalyticsReaction === 'dislike' ? true : false
                "
                >{{ postAnalytics?.dislikes }}</span
              >
            </div>
          </div>
        </div>
      </div>
      <!-- Last Posts Card -->
      <div
        class="card sticky-action last-posts"
        style="width: 400px; margin-left: 30px"
      >
        <div class="card-header last-articles-title card-content">
          <span>Últimos Artículos</span>
        </div>
        <div
          class="card-body last-article-body card-content grey lighten-4 dfc"
        >
          <!-- Last Articles List -->
          <div class="card-data-container dfc">
            <div
              *ngFor="let post of filteredLastPosts"
              class="article-container dfr"
            >
              <a
                class="article-content dfr"
                [routerLink]="['/articulo-detalle', post._id]"
              >
                <div class="last-article-img centered-img-bg">
                  <img [src]="post?.img | img: 'post'" [alt]="post?.title" />
                </div>
                <div class="last-article-data dfc">
                  <div class="last-article-name">
                    <span>{{ post?.title }}</span>
                  </div>
                  <div class="last-article-author">
                    <span
                      >{{ post?.user?.firstName }}
                      {{ post?.user?.lastName }}</span
                    >
                  </div>
                  <div class="last-article-rm dfr">
                    <span>Leer artículo</span>
                    <i class="material-icons">chevron_right</i>
                  </div>
                </div>
              </a>
            </div>
            <div
              *ngIf="filteredLastPosts?.length === 0"
              class="article-container no-data dfr"
            >
              <div class="card-no-data-icon dfc">
                <span>i</span>
              </div>
              <div class="card-no-data-information">
                <span> No se han publicado artículos recientemente</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer card-action"></div>
      </div>
    </div>

    <!-- Comments Card -->
    <div class="col s12 m7" id="comments-box" name="comments-box">
      <div class="card horizontal">
        <div class="card-stacked">
          <div class="comment-card-header card-content">
            <div class="comments-number"><span>120 Comentarios</span></div>
            <div class="filter-comments"><span>Filtrar Comentarios</span></div>
          </div>
          <div class="card-comment card-content">
            <div
              class="card-comment-content dfr"
              style="align-items: flex-start"
            >
              <div class="user-icon">
                <img src="../../../assets/images/user.jpg" />
              </div>
              <div class="input-field col s12">
                <input
                  id="comment"
                  name="comment"
                  type="text"
                  required
                  [readonly]="!this._usersS.isLogged()"
                  (click)="
                    this._usersS.isLogged()
                      ? showCommentButtons()
                      : showAlertModal('comment', $event)
                  "
                />
                <label class="comment-label" for="comment"
                  >Agregar comentario</label
                >
              </div>
            </div>
            <div class="comment-buttons">
              <button
                class="cancel-comment waves-effect waves-light orange darken-1 btn"
                type="submit"
              >
                Cancelar
              </button>
              <button
                class="send-comment waves-effect waves-light btn gradient-45deg-dark-blue"
                type="submit"
                [class.button.disabled]
              >
                Comentar
              </button>
            </div>
          </div>
          <!-- Comments Card Content -->
          <app-comments [comments]="postAnalytics?.comments"></app-comments>
        </div>
      </div>
    </div>
  </div>
</section>
