<section *ngIf="post" id="noticias-main-container" class="pr pt-71">
  <div id="noticias-content-container">
    <div class="noticias-data dfr">
      <!-- Detail Post Main Card Container -->
      <div class="post-main-card-container" style="width: calc(100% - 430px)">
        <!-- Detail Post Card Content -->
        <div class="card sticky-action w-full">
          <div class="card-header card-content">
            <div class="card-date">
              <div class="card-day">
                <span>{{ post?.created_at | date: "dd" }}</span>
              </div>
              <div class="card-month">
                <span>{{ post?.created_at | date: "MMM" }}</span>
              </div>
            </div>
            <div class="card-title-new">
              <span class="card-title">{{ post?.postTitle }}</span>
              <span class="card-autor"
                >{{ post?.user?.firstName }} {{ post?.user?.lastName }}</span
              >
            </div>
          </div>
          <div
            class="card-body-container card-body card-content grey lighten-4 dfc"
          >
            <div class="card-data main-post-data">
              <span class="card-data-container">
                <span
                  class="card-information"
                  [innerHTML]="post?.postContent | sanitizeHtml"
                ></span>
              </span>
              <!-- Detail Post Card Attached Files-->
              <div
                *ngIf="post?.attachedFiles.length > 0"
                class="card-attached-files"
              >
                <div class="card-attached-files-title">
                  <span>Archivos adjuntos de este artículo</span>
                </div>
                <div class="card-attached-files-list">
                  <div
                    class="card-attached-files-box w-full dfr"
                    *ngFor="let file of post?.attachedFiles"
                  >
                    <div
                      class="image centered-img-bg border-none dfr jcc"
                      [attr.data-format]="
                        _utilitiesS.formatType(file.path.split('.').pop())
                      "
                    >
                      <div
                        *ngIf="
                          _utilitiesS.formatType(file.path.split('.').pop()) ===
                          'pdf'
                        "
                        class="image-wrapper centered-img-bg border-none"
                      >
                        <img src="../../../assets/images/pdf_icon_2.png" />
                      </div>
                      <div
                        *ngIf="
                          _utilitiesS.formatType(file.path.split('.').pop()) ===
                          'word'
                        "
                        class="image-wrapper"
                      >
                        <img src="../../../assets/images/word_icon_2.png" />
                      </div>
                      <img
                        *ngIf="
                          _utilitiesS.formatType(file.path.split('.').pop()) ===
                          'image'
                        "
                        [src]="file?.path"
                      />
                    </div>
                    <div class="attached-file-details dfr h-full w-full">
                      <span class="attached-file-name">{{ file.name }}</span>
                      <span class="attached-file-size">{{
                        _utilitiesS.formatBytes(file.size)
                      }}</span>
                    </div>
                    <div
                      class="attached-file-actions header-item-actions dfr h-full"
                    >
                      <!-- Attached File Actions Button Trigger -->
                      <button
                        class="btn action-button transparent-bg border-none bs-none dfc"
                        mat-icon-button
                        matTooltip="Más acciones"
                        matTooltipPosition="above"
                        [matMenuTriggerFor]="attachedFileMenu"
                      >
                        <i class="material-icons big-icon">more_vert</i>
                      </button>
                      <!-- Attached File Actions Menu Content -->
                      <mat-menu #attachedFileMenu="matMenu" xPosition="before">
                        <ng-template matMenuContent>
                          <div class="dfc select-content-container">
                            <!-- File Preview Option -->
                            <button
                              mat-menu-item
                              (click)="
                                openFileViewModal(file?.path, file?.name)
                              "
                            >
                              <i class="material-icons">visibility</i>
                              Ver
                            </button>
                            <!-- Download File Option -->
                            <button
                              mat-menu-item
                              (click)="downloadFile(file.path)"
                            >
                              <i class="material-icons">file_download</i>
                              Descargar
                            </button>
                          </div>
                        </ng-template>
                      </mat-menu>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Detail Post Card Quotes-->
              <div *ngIf="post?.postQuotes.length > 0" class="card-quotes dfc">
                <div class="card-quotes-title w-full">
                  <span class="w-full">Citas Utilizadas</span>
                </div>
                <span
                  *ngFor="let quote of post?.postQuotes"
                  class="card-quote w-full"
                  ><i></i>{{ _utilitiesS.generateAPAQuote(quote) }}</span
                >
              </div>
            </div>
          </div>
          <div class="card-footer card-action">
            <div class="item-acordion-body-actions dfr">
              <!-- Post Contact Author By Email Button Trigger -->
              <button
                *ngIf="
                  _usersS.isLogged()
                    ? postAuthor._id !== this._usersS.user._id
                    : true
                "
                class="header-item-btn btn action-button dfc"
                mat-icon-button
                matTooltip="Contactar autor por correo"
                matTooltipPosition="above"
                (click)="openReplyModal(post.user)"
              >
                <i class="far fa-envelope"></i>
              </button>
              <!-- Post Contact Author By Message Button Trigger -->
              <button
                *ngIf="
                  _usersS.isLogged() && postAuthor._id !== this._usersS.user._id
                "
                class="header-item-btn btn action-button important-action dfc"
                mat-icon-button
                matTooltip="Contactar autor por mensaje"
                matTooltipPosition="above"
                (click)="openChat(post.user)"
              >
                <i class="far fa-comment"></i>
              </button>
              <!-- Post Like Button Trigger -->
              <div class="action-button-with-text-container dfc">
                <button
                  class="header-item-btn btn posts-btn action-button dfc"
                  mat-icon-button
                  matTooltip="Me gusta"
                  matTooltipPosition="above"
                  (click)="
                    this._usersS.isLogged()
                      ? updatePostReactions('like')
                      : showAlertModal('like', $event)
                  "
                  [attr.data-active]="
                    postAnalyticsReaction === 'like' ? true : false
                  "
                >
                  <i class="waves-effect material-icons new-like">thumb_up</i>
                </button>
                <span
                  class="action-counter"
                  [attr.data-active]="
                    postAnalyticsReaction === 'like' ? true : false
                  "
                  >{{ postAnalytics?.likes }}</span
                >
              </div>
              <!-- Post Dislike Button Trigger -->
              <div class="action-button-with-text-container dfc">
                <button
                  class="header-item-btn btn posts-btn action-button dfc"
                  mat-icon-button
                  matTooltip="No me gusta"
                  matTooltipPosition="above"
                  (click)="
                    this._usersS.isLogged()
                      ? updatePostReactions('dislike')
                      : showAlertModal('dislike', $event)
                  "
                  [attr.data-active]="
                    postAnalyticsReaction === 'dislike' ? true : false
                  "
                >
                  <i class="waves-effect material-icons new-dislike">
                    thumb_down
                  </i>
                </button>
                <span
                  class="action-counter"
                  [attr.data-active]="
                    postAnalyticsReaction === 'dislike' ? true : false
                  "
                  >{{ postAnalytics?.dislikes }}</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Last Posts Card -->
      <div
        class="card sticky-action last-posts"
        style="width: 400px; margin-left: 30px"
      >
        <div class="card-header last-articles-title card-content">
          <span>Últimos Artículos</span>
        </div>
        <div
          class="card-body last-article-body card-content grey lighten-4 dfc"
        >
          <!-- Last Articles List -->
          <div class="card-data-container dfc">
            <div
              *ngFor="let post of filteredLastPosts"
              class="article-container dfr"
            >
              <a
                class="article-content dfr"
                [routerLink]="['/articulo-detalle', post._id]"
              >
                <div class="last-article-img centered-img-bg">
                  <img
                    [src]="post?.postImage | img: 'post'"
                    [alt]="post?.postTitle"
                  />
                </div>
                <div class="last-article-data dfc">
                  <div class="last-article-name">
                    <span>{{ post?.postTitle }}</span>
                  </div>
                  <div class="last-article-author">
                    <span
                      >{{ post?.user?.firstName }}
                      {{ post?.user?.lastName }}</span
                    >
                  </div>
                  <div class="last-article-rm dfr">
                    <span>Leer artículo</span>
                    <i class="material-icons">chevron_right</i>
                  </div>
                </div>
              </a>
            </div>
            <div
              *ngIf="filteredLastPosts?.length === 0"
              class="article-container no-data dfr"
            >
              <div class="card-no-data-icon dfc">
                <span>i</span>
              </div>
              <div class="card-no-data-information">
                <span> No se han publicado artículos recientemente</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer card-action"></div>
      </div>
    </div>

    <!-- Comments Card -->
    <div class="col s12 m7" id="comments-box" name="comments-box">
      <div class="card horizontal">
        <div class="card-stacked">
          <div class="comment-card-header card-content">
            <div class="comments-number"><span>120 Comentarios</span></div>
            <div class="filter-comments"><span>Filtrar Comentarios</span></div>
          </div>
          <div class="card-comment card-content">
            <div
              class="card-comment-content dfr"
              style="align-items: flex-start"
            >
              <div class="user-icon">
                <img src="../../../assets/images/user.jpg" />
              </div>
              <div class="input-field col s12">
                <input
                  id="comment"
                  name="comment"
                  type="text"
                  required
                  [readonly]="!this._usersS.isLogged()"
                  (click)="
                    this._usersS.isLogged()
                      ? showCommentButtons()
                      : showAlertModal('comment', $event)
                  "
                />
                <label class="comment-label" for="comment"
                  >Agregar comentario</label
                >
              </div>
            </div>
            <div class="comment-buttons">
              <button
                class="cancel-comment waves-effect waves-light orange darken-1 btn"
                type="submit"
              >
                Cancelar
              </button>
              <button
                class="send-comment waves-effect waves-light btn gradient-45deg-dark-blue"
                type="submit"
                [class.button.disabled]
              >
                Comentar
              </button>
            </div>
          </div>
          <!-- Comments Card Content -->
          <app-comments [comments]="postAnalytics?.comments"></app-comments>
        </div>
      </div>
    </div>
  </div>
</section>
